{
    "sourceFile": "src/components/Player/index.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1652353620267,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1652353620267,
            "name": "Commit-0",
            "content": "import React, { useEffect, useState } from \"react\";\nimport {\n    Typography,\n    Paper,\n    Card,\n    CardActionArea,\n    CardMedia,\n    CardContent,\n    Button,\n    CardActions,\n    CardHeader,\n} from \"@material-ui/core\";\nimport withStyles from \"@material-ui/core/styles/withStyles\";\nimport { Link, withRouter } from \"react-router-dom\";\nimport firebase from \"../../firebase\";\nimport \"../../../node_modules/bootstrap/dist/css/bootstrap.css\";\nimport Bar from \"../Bar\";\nimport \"../Player/style.css\";\nimport \"../Bar/index.css\";\n\nconst styles = (theme) => ({\n    root: {\n        width: \"auto\",\n        display: \"block\", // Fix IE 11 issue.\n        [theme.breakpoints.up(\"auto\" + theme.spacing.unit * 3 * 2)]: {\n            width: \"auto\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n        },\n        backgroundColor: \"#210548\",\n    },\n    main: {\n        width: \"auto\",\n        display: \"block\", // Fix IE 11 issue.\n        marginLeft: theme.spacing.unit * 2,\n        marginRight: theme.spacing.unit * 2,\n        [theme.breakpoints.up(\"auto\" + theme.spacing.unit * 3 * 2)]: {\n            width: \"auto\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n        },\n        backgroundColor: \"#210548\",\n    },\n\n    relatedVideoPaper: {\n        marginTop: theme.spacing.unit * 2,\n        // marginBottom: theme.spacing.unit * 6,\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: \"center\",\n        padding: `${theme.spacing.unit * 1}px ${theme.spacing.unit * 2}px ${\n            theme.spacing.unit * 2\n        }px`,\n        backgroundColor: \"#210548\",\n        color: \"white\",\n    },\n    paper: {\n        marginTop: theme.spacing.unit * 8,\n        marginBottom: theme.spacing.unit * 6,\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: \"center\",\n        padding: `${theme.spacing.unit * 1}px ${theme.spacing.unit * 2}px ${\n            theme.spacing.unit * 2\n        }px`,\n        backgroundColor: \"#210548\",\n    },\n\n    videoName: {\n        marginTop: theme.spacing.unit * 3,\n\n        fontSize: \"20px\",\n    },\n    Tag: {\n        width: theme.spacing.unit * 10,\n        backgroundColor: \"#FFC0CB\",\n        textAlign: \"center\",\n        borderRadius: \"10px\",\n        borderColor: \"#ffffff\",\n        borderStyle: \"solid\",\n    },\n    Card: {\n        marginTop: theme.spacing.unit * 2,\n        height: theme.spacing.unit * 45,\n        backgroundColor: \"#210548\",\n        color: \"white\",\n    },\n    VideoCard: {\n        marginTop: theme.spacing.unit * 8,\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: \"left\",\n        padding: `${theme.spacing.unit * 1}px ${theme.spacing.unit * 2}px ${\n            theme.spacing.unit * 2\n        }px`,\n        height: \"auto\",\n        backgroundColor: \"#210548\",\n    },\n    CardMedia: {\n        paddingLeft: theme.spacing.unit * 1,\n        paddingRight: theme.spacing.unit * 1,\n        paddingTop: theme.spacing.unit * 1,\n    },\n    titleBar: {\n        display: \"block\",\n        width: \"100%\",\n        overflow: \"hidden\",\n        textOverflow: \"ellipsis\",\n        lineHeight: \"normal\",\n    },\n    submit: {\n        marginTop: theme.spacing.unit * 3,\n        color: \"white\",\n    },\n    adView: {\n        position: \"absolute\",\n        left: 50,\n        top: 50,\n    },\n    category: {\n        marginTop: theme.spacing.unit * 1,\n        color: \"#FCFCFC\",\n    },\n    title: {\n        color: \"#FCFCFC\",\n    },\n    TimeTag: {\n        width: theme.spacing.unit * 8,\n        backgroundColor: \"#808080\",\n        textAlign: \"center\",\n        borderRadius: \"6px\",\n        borderColor: \"#ffffff\",\n    },\n});\n\nfunction Player(props) {\n    const { classes } = props;\n    const [relatedVideo, setRelatedVideo] = useState([]);\n    const [controlVideo, setControlVideo] = useState(true);\n    const [url, setUrl] = useState(\"\");\n    const [count, setCount] = useState(0);\n    const [intervalID, setIntervalID] = useState(-1);\n    const [category, setCategory] = useState(\"\");\n    const [videoUrl, setVideoUrl] = useState(\"\");\n    const [videoName, setVideoName] = useState(\"\");\n    const [timestamp, setTimeStamp] = useState(\"\");\n    const [tags, setTags] = useState([]);\n    const [isPlaying, setIsPlaying] = useState(false);\n    const [watchCount, setWatchCount] = useState(0);\n    const id = props.match.params.id;\n\n    useEffect(() => {\n        // startInterval()\n        getVideoByID();\n    }, []);\n\n    return (\n        <div className={classes.main}>\n            <Bar></Bar>\n            <div className=\"row\">\n                <div className=\"col-md-12\">\n                    <Card className={classes.VideoCard}>\n                        <CardHeader\n                            className={classes.title}\n                            title={videoName}\n                        ></CardHeader>\n                        <CardActions>\n                            <CardMedia\n                                className={classes.CardMedia}\n                                component=\"video\"\n                                alt=\"video\"\n                                preload=\"metadata\"\n                                width=\"50%\"\n                                height=\"500\"\n                                title={videoName}\n                                src={videoUrl}\n                                controls={true}\n                                onContextMenu={(e) => e.preventDefault()}\n                                config={{\n                                    file: { attributes: { controlsList: \"nodownload\" } },\n                                }}\n                            />\n                        </CardActions>\n                        <CardContent style={{ color: \"#FCFCFC\" }}>\n                            <Typography gutterBottom variant=\"h8\" component=\"div\">\n                                上載時間： {convertTimeStamp(timestamp)}\n                            </Typography>\n                            <div className=\"box\">\n                                <Typography\n                                    gutterBottom\n                                    variant=\"h8\"\n                                    component=\"div\"\n                                    style={{\n                                        color: \"#FCFCFC\",\n                                        paddingTop: \"12px\",\n                                        paddingRight: \"10px\",\n                                    }}\n                                >\n                                    標籤:\n                                </Typography>\n                                {tags.map(function (value, index) {\n                                    return (\n                                        <div>\n                                            <div className=\"tag\">\n                                                <button\n                                                    id={index}\n                                                    style={{ paddingLeft: \"2px\" }}\n                                                    component={Link}\n                                                    to={{\n                                                        pathname: `/filter/category/${category}`,\n                                                        state: {\n                                                            tag: value,\n                                                        },\n                                                    }}\n                                                >\n                                                    {value}\n                                                </button>\n                                            </div>\n                                        </div>\n                                    );\n                                })}\n                            </div>\n                            <Typography\n                                gutterBottom\n                                variant=\"h8\"\n                                component=\"div\"\n                                style={{\n                                    color: \"#FCFCFC\",\n                                    paddingTop: \"12px\",\n                                    paddingRight: \"10px\",\n                                }}\n                            >\n                                類別:\n                            </Typography>\n                            <Button\n                                type=\"submit\"\n                                variant=\"contained\"\n                                color=\"secondary\"\n                                component={Link}\n                                to={{\n                                    pathname: `/filter/category/${category}`,\n                                    state: {\n                                        category: category,\n                                    },\n                                }}\n                                className={classes.category}\n                            >\n                                {category}\n                            </Button>\n                        </CardContent>\n                    </Card>\n                </div>\n            </div>\n            <Paper className={classes.relatedVideoPaper}>\n                <Typography\n                    className={classes.videoName}\n                    component=\"h2\"\n                    variant=\"h5\"\n                    align=\"left\"\n                >\n                    相關影片\n                </Typography>\n                <div className=\"row\">\n                    {relatedVideo.map(function (value, index) {\n                        console.log(value.previewUrl);\n                        return (\n                            <div className=\"col-md-4\">\n                                <Card className={classes.Card}>\n                                    <div className={classes.TimeTag}>\n                                        {convertTime(value.duration)}\n                                    </div>\n                                    <CardActionArea\n                                        component={Link}\n                                        to={{\n                                            pathname: `/player/id/${value.id}`,\n                                        }}\n                                        target=\"_blank\"\n                                    >\n                                        <CardMedia\n                                            className={classes.CardMedia}\n                                            component={value.previewUrl ? \"img\" : \"video\"}\n                                            preload=\"metadata\"\n                                            alt={value.previewUrl ? \"image\" : \"video\"}\n                                            width=\"100%\"\n                                            height=\"200\"\n                                            title={value.fileName}\n                                            src={`${value.previewUrl || value.url}#t=0.5`}\n                                        />\n                                    </CardActionArea>\n                                    <CardContent>\n                                        <Typography\n                                            gutterBottom\n                                            variant=\"h8\"\n                                            component=\"div\"\n                                        >\n                                            {value.fileName}\n                                        </Typography>\n                                        <Typography\n                                            gutterBottom\n                                            variant=\"h8\"\n                                            component=\"div\"\n                                        >\n                                            {convertTimeStamp(value.timestamp)}\n                                        </Typography>\n                                        <Typography\n                                            gutterBottom\n                                            variant=\"h8\"\n                                            component=\"div\"\n                                        >\n                                            <div className={classes.Tag}>\n                                                {value.category}\n                                            </div>\n                                        </Typography>\n                                    </CardContent>\n                                </Card>\n                            </div>\n                        );\n                    })}\n                </div>\n            </Paper>\n        </div>\n    );\n\n    function convertTime(num) {\n        var minutes = Math.floor(num / 60);\n        var seconds = Math.round(num % 60);\n\n        if (minutes < 10) {\n            minutes = \"0\" + minutes;\n        }\n\n        if (seconds < 10) {\n            seconds = \"0\" + seconds;\n        }\n\n        var timestamp = minutes + \":\" + seconds;\n\n        return timestamp;\n    }\n\n    function convertTimeStamp(timestamp) {\n        var date = new Date(timestamp);\n        var year = date.getFullYear();\n        var month = date.getMonth() + 1;\n        var day = date.getDate();\n\n        if (day < 10) {\n            day = \"0\" + day;\n        }\n        if (month < 10) {\n            month = \"0\" + month;\n        }\n\n        var newDate = year + \"-\" + month + \"-\" + day;\n\n        return newDate;\n    }\n\n    function getVideoByID() {\n        firebase.db\n            .ref(\"VideoList/\")\n            .orderByChild(\"id\")\n            .equalTo(id)\n            .on(\"value\", function (snapshot) {\n                if (snapshot.exists()) {\n                    snapshot.forEach(function (value) {\n                        setVideoUrl(value.val().url);\n                        setCategory(value.val().category);\n                        setVideoName(value.val().fileName);\n                        setTimeStamp(value.val().timestamp);\n\n                        if (value.val().tag) {\n                            setTags(value.val().tag);\n                        }\n                        if (value.val().watchCount) {\n                            setWatchCount(value.val().watchCount);\n                        }\n\n                        getVideoByCategory(value.val().category);\n                    });\n                }\n            });\n    }\n\n    function getVideoByCategory(category) {\n        var filterArray = [];\n        var reversedArray = [];\n        firebase.db\n            .ref(\"VideoList/\")\n            .orderByChild(\"category\")\n            .equalTo(category)\n            .limitToLast(20)\n            .on(\"value\", function (snapshot) {\n                if (snapshot.exists()) {\n                    snapshot.forEach(function (result) {\n                        filterArray.push(result.val());\n                    });\n                    reversedArray = [...filterArray].reverse();\n                    console.log(filterArray);\n                    setRelatedVideo(reversedArray);\n                }\n            });\n    }\n}\n\nexport default withRouter(withStyles(styles)(Player));\n"
        }
    ]
}